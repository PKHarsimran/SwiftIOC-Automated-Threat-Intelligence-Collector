<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SwiftIOC Threat Intelligence Dashboard</title>
    <meta
      name="description"
      content="Live overview of the latest SwiftIOC automated threat intelligence collection run with key metrics, top sources, and download links."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <meta name="theme-color" content="#0f172a" />
    <style>
      :root {
        color-scheme: dark light;
        --bg: #0f172a;
        --bg-card: rgba(15, 23, 42, 0.86);
        --bg-card-light: rgba(30, 41, 59, 0.85);
        --border: rgba(148, 163, 184, 0.25);
        --text: #e2e8f0;
        --text-muted: rgba(226, 232, 240, 0.7);
        --accent: #38bdf8;
        --accent-strong: #0ea5e9;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
        background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.12), transparent 55%),
          var(--bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        padding: clamp(1.5rem, 3vw, 3.5rem);
      }

      main {
        width: min(100%, 1100px);
        display: flex;
        flex-direction: column;
        gap: clamp(1.5rem, 3vw, 2.5rem);
      }

      header {
        background: var(--bg-card);
        padding: clamp(1.5rem, 3vw, 2.75rem);
        border-radius: 1.5rem;
        border: 1px solid var(--border);
        box-shadow: 0 24px 55px rgba(15, 23, 42, 0.5);
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      h1 {
        font-size: clamp(1.8rem, 4vw, 2.5rem);
        margin: 0;
      }

      header p {
        margin: 0;
        color: var(--text-muted);
        line-height: 1.6;
      }

      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem 1.25rem;
        font-size: 0.95rem;
        color: var(--text-muted);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
      }

      .button-link {
        padding: 0.65rem 1.15rem;
        border-radius: 999px;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid transparent;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .button-link.primary {
        background: var(--accent);
        color: #0b1324;
      }

      .button-link.secondary {
        background: transparent;
        border-color: var(--border);
        color: var(--text);
      }

      .button-link:hover,
      .button-link:focus-visible {
        transform: translateY(-1px);
        background: rgba(56, 189, 248, 0.12);
      }

      .button-link.primary:hover,
      .button-link.primary:focus-visible {
        background: var(--accent-strong);
        color: #f8fafc;
      }

      section {
        background: var(--bg-card-light);
        border-radius: 1.5rem;
        border: 1px solid var(--border);
        padding: clamp(1.35rem, 3vw, 2.25rem);
        display: flex;
        flex-direction: column;
        gap: 1.35rem;
      }

      h2 {
        margin: 0;
        font-size: clamp(1.3rem, 3vw, 1.6rem);
      }

      .grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      .metric-card {
        border-radius: 1.25rem;
        border: 1px solid rgba(148, 163, 184, 0.2);
        padding: 1.1rem 1.35rem;
        background: rgba(15, 23, 42, 0.72);
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .metric-card span {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .metric-card strong {
        font-size: clamp(1.45rem, 3vw, 1.9rem);
        font-weight: 700;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        border-spacing: 0;
      }

      th,
      td {
        text-align: left;
        padding: 0.6rem 0.75rem;
        border-bottom: 1px solid rgba(148, 163, 184, 0.18);
      }

      th {
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        color: var(--text-muted);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      .muted {
        color: var(--text-muted);
      }

      footer {
        text-align: center;
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      a {
        color: var(--accent);
      }

      .hidden {
        display: none !important;
      }

      @media (max-width: 640px) {
        body {
          padding: 1rem;
        }

        header,
        section {
          border-radius: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <div>
          <h1>SwiftIOC Threat Intelligence Dashboard</h1>
          <p>
            Live metrics from the most recent automated collection run. Review the top reporting
            sources, indicator mix, and overlaps before diving into the full dataset.
          </p>
        </div>
        <div class="meta" id="meta">
          <span id="generated" class="muted">Loading latest run information…</span>
        </div>
        <div class="actions">
          <a class="button-link primary" href="public/">Open complete dashboard</a>
          <a class="button-link secondary" href="public/diagnostics/summary.md">View Markdown summary</a>
          <a class="button-link secondary" href="README.md">Implementation guide</a>
        </div>
      </header>

      <section>
        <h2>Highlights</h2>
        <div class="grid" id="highlight-grid"></div>
        <p id="highlight-empty" class="muted hidden">
          Highlights will appear once the first run completes and publishes a JSON summary.
        </p>
      </section>

      <section>
        <h2>Per-source totals</h2>
        <table>
          <thead>
            <tr>
              <th scope="col">Source</th>
              <th scope="col">Indicators</th>
            </tr>
          </thead>
          <tbody id="source-body"></tbody>
        </table>
        <p id="source-empty" class="muted hidden">No source statistics available yet.</p>
      </section>

      <section>
        <h2>Indicator types</h2>
        <table>
          <thead>
            <tr>
              <th scope="col">Type</th>
              <th scope="col">Indicators</th>
            </tr>
          </thead>
          <tbody id="type-body"></tbody>
        </table>
        <p id="type-empty" class="muted hidden">Indicator type statistics will appear after a run.</p>
      </section>

      <section>
        <h2>Top tags</h2>
        <table>
          <thead>
            <tr>
              <th scope="col">Tag</th>
              <th scope="col">Indicators</th>
            </tr>
          </thead>
          <tbody id="tag-body"></tbody>
        </table>
        <p id="tag-empty" class="muted hidden">Tags are populated when data sources provide them.</p>
      </section>

      <section>
        <h2>Multi-source overlaps</h2>
        <table>
          <thead>
            <tr>
              <th scope="col">Indicator</th>
              <th scope="col">Sources</th>
            </tr>
          </thead>
          <tbody id="overlap-body"></tbody>
        </table>
        <p id="overlap-empty" class="muted hidden">No overlapping indicators detected yet.</p>
      </section>

      <section>
        <h2>Troubleshooting & raw data</h2>
        <p class="muted">
          If the cards above are empty, the JSON summary may not have been generated yet. Download the
          raw diagnostics to investigate the latest run: <a href="public/diagnostics/run.json">run.json</a>
          · <a href="public/diagnostics/REPORT.md">REPORT.md</a> ·
          <a href="public/iocs/latest.jsonl">latest.jsonl</a>.
        </p>
      </section>

      <footer>
        Built for the SwiftIOC packaged edition. Fork, adapt, or extend for your security operations
        teams.
      </footer>
    </main>

    <script>
      const SUMMARY_URL = "public/diagnostics/summary.json";
      const highlightGrid = document.getElementById("highlight-grid");
      const highlightEmpty = document.getElementById("highlight-empty");
      const generatedEl = document.getElementById("generated");

      const tables = [
        { body: document.getElementById("source-body"), empty: document.getElementById("source-empty"), key: "top_sources", labelKey: "source" },
        { body: document.getElementById("type-body"), empty: document.getElementById("type-empty"), key: "top_indicator_types", labelKey: "type" },
        { body: document.getElementById("tag-body"), empty: document.getElementById("tag-empty"), key: "top_tags", labelKey: "tag" },
      ];

      const overlapBody = document.getElementById("overlap-body");
      const overlapEmpty = document.getElementById("overlap-empty");

      const highlightDefinitions = [
        { key: "total_indicators", label: "Total indicators" },
        { key: "duplicates_removed", label: "Duplicates removed" },
        { key: "sources_reporting", label: "Sources reporting" },
        { key: "indicator_types", label: "Indicator types" },
        { key: "multi_source_overlaps", label: "Multi-source overlaps" },
        { key: "window_hours", label: "Window (hours)" },
        { key: "earliest_first_seen", label: "Earliest first_seen" },
        { key: "newest_first_seen", label: "Newest first_seen" },
      ];

      function formatNumber(value) {
        if (typeof value === "number") {
          return value.toLocaleString();
        }
        if (value === null || value === undefined) {
          return "—";
        }
        return String(value);
      }

      function renderHighlights(data) {
        highlightGrid.innerHTML = "";
        let populated = 0;
        highlightDefinitions.forEach((item) => {
          const value = data[item.key];
          if (value === undefined || value === null || value === "") {
            return;
          }
          const card = document.createElement("div");
          card.className = "metric-card";
          const label = document.createElement("span");
          label.textContent = item.label;
          const strong = document.createElement("strong");
          strong.textContent = formatNumber(value);
          card.appendChild(label);
          card.appendChild(strong);
          highlightGrid.appendChild(card);
          populated += 1;
        });
        highlightEmpty.classList.toggle("hidden", populated > 0);
      }

      function renderTable(tableDef, rows) {
        tableDef.body.innerHTML = "";
        if (!rows || rows.length === 0) {
          tableDef.empty.classList.remove("hidden");
          return;
        }
        tableDef.empty.classList.add("hidden");
        rows.forEach((row) => {
          const tr = document.createElement("tr");
          const labelCell = document.createElement("td");
          labelCell.textContent = row[tableDef.labelKey] ?? "—";
          const valueCell = document.createElement("td");
          valueCell.textContent = formatNumber(row.indicators ?? row.count ?? row.value ?? 0);
          valueCell.style.textAlign = "right";
          tr.appendChild(labelCell);
          tr.appendChild(valueCell);
          tableDef.body.appendChild(tr);
        });
      }

      function renderOverlaps(rows) {
        overlapBody.innerHTML = "";
        if (!rows || rows.length === 0) {
          overlapEmpty.classList.remove("hidden");
          return;
        }
        overlapEmpty.classList.add("hidden");
        rows.forEach((row) => {
          const tr = document.createElement("tr");
          const indicatorCell = document.createElement("td");
          indicatorCell.textContent = `${row.type ?? "?"}: ${row.indicator ?? "(unknown)"}`;
          const sourcesCell = document.createElement("td");
          sourcesCell.textContent = Array.isArray(row.sources) ? row.sources.join(", ") : String(row.sources ?? "—");
          tr.appendChild(indicatorCell);
          tr.appendChild(sourcesCell);
          overlapBody.appendChild(tr);
        });
      }

      async function hydrate() {
        try {
          const response = await fetch(SUMMARY_URL, { cache: "no-store" });
          if (!response.ok) {
            throw new Error(`Failed to fetch summary: ${response.status}`);
          }
          const data = await response.json();
          if (data.generated) {
            generatedEl.textContent = `Generated ${data.generated}`;
          } else {
            generatedEl.textContent = "Summary loaded";
          }
          renderHighlights(data);
          tables.forEach((table) => renderTable(table, data[table.key]));
          renderOverlaps(data.overlaps);
        } catch (error) {
          console.error(error);
          generatedEl.textContent =
            "Unable to load summary.json. Use the links above to browse the latest artifacts.";
          highlightEmpty.classList.remove("hidden");
          tables.forEach((table) => table.empty.classList.remove("hidden"));
          overlapEmpty.classList.remove("hidden");
        }
      }

      hydrate();
    </script>
  </body>
</html>
